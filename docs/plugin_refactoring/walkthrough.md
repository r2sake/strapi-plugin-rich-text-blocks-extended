# 修正内容の確認: PrismJS 初期化フローの改善

## 概要
PrismJS の初期化における競合状態とエラーを解消するため、プラグインの初期化プロセスをリファクタリングしました。

## 実施した変更

### 1. 初期化ロジックの堅牢化 (`admin/src/utils/prism-init.ts`)
- **変更前**: 関数が呼ばれるたびに初期化処理が走っていた。
- **変更後**: `isInitialized` フラグによるガードを追加し、初回のみ実行されるようにしました。これにより、複数箇所から呼ばれても安全になりました。

### 2. ブートストラップへの移動 (`admin/src/index.ts`)
- **変更前**: 同期的な `register` フック内で `initPrism` を呼び出しており、初期化完了を待てなかった。
- **変更後**: 非同期な `bootstrap` フックに移動し、`await initPrism()` で完了を待機するようにしました。これにより、アプリ起動時に言語定義が確実にロードされることを目指します。

### 3. コンポーネント呼び出しの整理 (`admin/src/components/BlocksInput/Blocks/Code.tsx`)
- **変更前**: コンポーネントファイル内でも `initPrism()` を呼び出しており、不要な再実行や競合のリスクがあった。
- **変更後**: 呼び出しを削除し、`decorateCode` 関数内で指定言語が未ロードの場合でもクラッシュしないよう、フォールバック（plaintext）処理を追加しました。

## 次のステップ
以下の手順で動作確認を行ってください。

1. プラグインディレクトリでビルドを実行:
   ```bash
   npm run build
   # または、CMS側のnode_modulesへ反映するためのカスタムスクリプトがあればそれを実行
   ```

2. CMS (Sakepo CMS) を再起動:
   ```bash
   npm run develop
   ```

3. Admin パネルで確認:
   - 管理画面にアクセスし、コンソールエラー（"Cannot set properties of undefined" 等）が出ていないか確認。
   - リッチテキストエディタでコードブロックを作成し、言語を選択してハイライトが適用されるか確認。
